<!DOCTYPE html>
<html lang="da">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Er det fuldmÃ¥ne?</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        min-height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        background: radial-gradient(
            ellipse at top,
            #1a1a3e 0%,
            #0f0f23 50%,
            #000000 100%
          ),
          repeating-linear-gradient(
            0deg,
            transparent,
            transparent 2px,
            rgba(255, 255, 255, 0.03) 2px,
            rgba(255, 255, 255, 0.03) 4px
          );
        color: white;
        padding: 20px;
        position: relative;
        overflow: hidden;
      }

      body::before {
        content: "";
        position: absolute;
        width: 100%;
        height: 100%;
        background-image: radial-gradient(
            2px 2px at 20% 30%,
            white,
            transparent
          ),
          radial-gradient(2px 2px at 60% 70%, white, transparent),
          radial-gradient(1px 1px at 50% 50%, white, transparent),
          radial-gradient(1px 1px at 80% 10%, white, transparent),
          radial-gradient(2px 2px at 90% 60%, white, transparent),
          radial-gradient(1px 1px at 33% 80%, white, transparent),
          radial-gradient(1px 1px at 15% 60%, white, transparent);
        background-size: 200% 200%;
        opacity: 0.4;
        animation: twinkle 8s ease-in-out infinite;
      }

      @keyframes twinkle {
        0%,
        100% {
          opacity: 0.3;
        }
        50% {
          opacity: 0.6;
        }
      }

      .container {
        text-align: center;
        max-width: 600px;
        width: 100%;
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border-radius: 30px;
        padding: 60px 40px;
        box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
        border: 1px solid rgba(255, 255, 255, 0.18);
        position: relative;
        z-index: 1;
      }

      h1 {
        font-size: 3rem;
        margin-bottom: 40px;
        font-weight: 300;
        letter-spacing: 2px;
      }

      .moon-container {
        margin: 40px 0;
      }

      .moon {
        font-size: 120px;
        display: inline-block;
        animation: float 3s ease-in-out infinite;
      }

      @keyframes float {
        0%,
        100% {
          transform: translateY(0px);
        }
        50% {
          transform: translateY(-20px);
        }
      }

      .answer {
        font-size: 2.5rem;
        font-weight: bold;
        margin: 30px 0;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
      }

      .answer.yes {
        color: #ffd700;
      }

      .answer.no {
        color: #e0e0e0;
      }

      .details {
        font-size: 1.1rem;
        opacity: 0.9;
        margin-top: 20px;
        line-height: 1.6;
      }

      .date {
        font-size: 1rem;
        opacity: 0.7;
        margin-top: 30px;
        font-style: italic;
      }

      .phase-info {
        margin-top: 15px;
        margin-bottom: 20px;
        font-size: 1.1rem;
        opacity: 0.85;
        font-weight: 500;
      }

      .last-full-moon {
        font-size: 0.95rem;
        opacity: 0.75;
        margin-top: 25px;
        padding-top: 20px;
        border-top: 1px solid rgba(255, 255, 255, 0.2);
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>Er det fuldmÃ¥ne?</h1>
      <div class="moon-container">
        <div class="moon" id="moonEmoji">ðŸŒ•</div>
      </div>
      <div class="phase-info" id="phaseInfo"></div>
      <div class="answer" id="answer">Beregner...</div>
      <div class="details" id="details"></div>
      <div class="last-full-moon" id="lastFullMoon"></div>
      <div class="date" id="date"></div>
    </div>

    <script>
      // Calculate moon phase
      function getMoonPhase(date) {
        // Convert date to UTC
        const year = date.getFullYear();
        const month = date.getMonth() + 1;
        const day = date.getDate();

        // Calculate Julian Date
        let jd =
          367 * year -
          Math.floor((7 * (year + Math.floor((month + 9) / 12))) / 4) +
          Math.floor((275 * month) / 9) +
          day +
          1721013.5;

        // Days since known new moon (January 6, 2000)
        const daysSinceNew = jd - 2451549.5;

        // Lunar month is approximately 29.53059 days
        const lunarMonth = 29.53059;

        // Calculate phase (0-1, where 0 and 1 are new moon, 0.5 is full moon)
        const phase = (daysSinceNew / lunarMonth) % 1;

        return phase;
      }

      function getMoonEmoji(phase) {
        if (phase < 0.0625) return "ðŸŒ‘"; // New Moon
        if (phase < 0.1875) return "ðŸŒ’"; // Waxing Crescent
        if (phase < 0.3125) return "ðŸŒ“"; // First Quarter
        if (phase < 0.4375) return "ðŸŒ”"; // Waxing Gibbous
        if (phase < 0.5625) return "ðŸŒ•"; // Full Moon
        if (phase < 0.6875) return "ðŸŒ–"; // Waning Gibbous
        if (phase < 0.8125) return "ðŸŒ—"; // Last Quarter
        if (phase < 0.9375) return "ðŸŒ˜"; // Waning Crescent
        return "ðŸŒ‘"; // New Moon
      }

      function getPhaseName(phase) {
        if (phase < 0.0625) return "NymÃ¥ne";
        if (phase < 0.1875) return "Tiltagende mÃ¥nesigel";
        if (phase < 0.3125) return "FÃ¸rste kvarter";
        if (phase < 0.4375) return "Tiltagende mÃ¥ne";
        if (phase < 0.5625) return "FuldmÃ¥ne";
        if (phase < 0.6875) return "Aftagende mÃ¥ne";
        if (phase < 0.8125) return "Sidste kvarter";
        if (phase < 0.9375) return "Aftagende mÃ¥nesigel";
        return "NymÃ¥ne";
      }

      function getNextFullMoon(currentDate, currentPhase) {
        const lunarMonth = 29.53059;
        let daysUntilFull;

        if (currentPhase < 0.5) {
          // Moon is waxing, full moon is ahead
          daysUntilFull = (0.5 - currentPhase) * lunarMonth;
        } else {
          // Moon is waning, next full moon is in next cycle
          daysUntilFull = (1.5 - currentPhase) * lunarMonth;
        }

        return Math.round(daysUntilFull);
      }

      function getLastFullMoon(currentDate, currentPhase) {
        const lunarMonth = 29.53059;
        let daysSinceFull;

        if (currentPhase < 0.5) {
          // Moon is waxing, last full moon was in previous cycle
          daysSinceFull = (0.5 + currentPhase) * lunarMonth;
        } else {
          // Moon is waning, full moon was earlier this cycle
          daysSinceFull = (currentPhase - 0.5) * lunarMonth;
        }

        const lastFullMoonDate = new Date(currentDate);
        lastFullMoonDate.setDate(
          lastFullMoonDate.getDate() - Math.round(daysSinceFull),
        );

        return lastFullMoonDate;
      }

      // Get current date in Denmark timezone
      const now = new Date();
      const denmarkTime = new Date(
        now.toLocaleString("en-US", { timeZone: "Europe/Copenhagen" }),
      );

      // Calculate moon phase
      const phase = getMoonPhase(denmarkTime);
      const moonEmoji = getMoonEmoji(phase);
      const phaseName = getPhaseName(phase);

      // Check if it's a full moon (within Â±1.5 days of full moon = phase 0.45 to 0.55)
      const isFullMoon = phase >= 0.45 && phase <= 0.55;

      // Update the page
      document.getElementById("moonEmoji").textContent = moonEmoji;

      if (isFullMoon) {
        document.getElementById("answer").textContent = "JA! ðŸŽ‰";
        document.getElementById("answer").className = "answer yes";
        document.getElementById("details").textContent =
          "Det er fuldmÃ¥ne i nat!";
      } else {
        document.getElementById("answer").textContent = "NEJ";
        document.getElementById("answer").className = "answer no";
        const daysUntil = getNextFullMoon(denmarkTime, phase);
        if (daysUntil === 0) {
          document.getElementById("details").textContent =
            "NÃ¦ste fuldmÃ¥ne er i morgen!";
        } else if (daysUntil === 1) {
          document.getElementById("details").textContent =
            "NÃ¦ste fuldmÃ¥ne er om 1 dag.";
        } else {
          document.getElementById(
            "details",
          ).textContent = `NÃ¦ste fuldmÃ¥ne er om cirka ${daysUntil} dage.`;
        }
      }

      document.getElementById("phaseInfo").textContent = phaseName;

      // Calculate and display last full moon
      const lastFullMoonDate = getLastFullMoon(denmarkTime, phase);
      const daysSinceFullMoon = Math.round(
        (denmarkTime - lastFullMoonDate) / (1000 * 60 * 60 * 24),
      );

      const lastFullMoonOptions = {
        year: "numeric",
        month: "long",
        day: "numeric",
        timeZone: "Europe/Copenhagen",
      };
      const lastFullMoonString = lastFullMoonDate.toLocaleDateString(
        "da-DK",
        lastFullMoonOptions,
      );

      if (daysSinceFullMoon === 0) {
        document.getElementById("lastFullMoon").textContent =
          "Sidste fuldmÃ¥ne: I dag!";
      } else if (daysSinceFullMoon === 1) {
        document.getElementById(
          "lastFullMoon",
        ).textContent = `Sidste fuldmÃ¥ne: I gÃ¥r (${lastFullMoonString})`;
      } else {
        document.getElementById(
          "lastFullMoon",
        ).textContent = `Sidste fuldmÃ¥ne: ${lastFullMoonString} (${daysSinceFullMoon} dage siden)`;
      }

      // Format date in Danish
      const options = {
        weekday: "long",
        year: "numeric",
        month: "long",
        day: "numeric",
        timeZone: "Europe/Copenhagen",
      };
      const dateString = denmarkTime.toLocaleDateString("da-DK", options);
      document.getElementById("date").textContent = dateString;
    </script>
    <script>
      window.va =
        window.va ||
        function () {
          (window.vaq = window.vaq || []).push(arguments);
        };
    </script>
    <script defer src="/_vercel/insights/script.js"></script>
  </body>
</html>
